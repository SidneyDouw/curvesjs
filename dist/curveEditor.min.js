!function(t,i){"function"==typeof define&&define.amd?define(["jquery"],i):t.main=i(t.$)}(this,function(t){var i,o,s;return function(t){function n(t,i){return g.call(t,i)}function p(t,i){var o,s,n,p,c,e,h,r,f,x,u,a=i&&i.split("/"),l=w.map,y=l&&l["*"]||{};if(t&&"."===t.charAt(0))if(i){for(t=t.split("/"),c=t.length-1,w.nodeIdCompat&&b.test(t[c])&&(t[c]=t[c].replace(b,"")),t=a.slice(0,a.length-1).concat(t),f=0;f<t.length;f+=1)if(u=t[f],"."===u)t.splice(f,1),f-=1;else if(".."===u){if(1===f&&(".."===t[2]||".."===t[0]))break;f>0&&(t.splice(f-1,2),f-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((a||y)&&l){for(o=t.split("/"),f=o.length;f>0;f-=1){if(s=o.slice(0,f).join("/"),a)for(x=a.length;x>0;x-=1)if(n=l[a.slice(0,x).join("/")],n&&(n=n[s])){p=n,e=f;break}if(p)break;!h&&y&&y[s]&&(h=y[s],r=f)}!p&&h&&(p=h,e=r),p&&(o.splice(0,e,p),t=o.join("/"))}return t}function c(i,o){return function(){var s=k.call(arguments,0);return"string"!=typeof s[0]&&1===s.length&&s.push(null),a.apply(t,s.concat([i,o]))}}function e(t){return function(i){return p(i,t)}}function h(t){return function(i){v[t]=i}}function r(i){if(n(d,i)){var o=d[i];delete d[i],m[i]=!0,u.apply(t,o)}if(!n(v,i)&&!n(m,i))throw new Error("No "+i);return v[i]}function f(t){var i,o=t?t.indexOf("!"):-1;return o>-1&&(i=t.substring(0,o),t=t.substring(o+1,t.length)),[i,t]}function x(t){return function(){return w&&w.config&&w.config[t]||{}}}var u,a,l,y,v={},d={},w={},m={},g=Object.prototype.hasOwnProperty,k=[].slice,b=/\.js$/;l=function(t,i){var o,s=f(t),n=s[0];return t=s[1],n&&(n=p(n,i),o=r(n)),n?t=o&&o.normalize?o.normalize(t,e(i)):p(t,i):(t=p(t,i),s=f(t),n=s[0],t=s[1],n&&(o=r(n))),{f:n?n+"!"+t:t,n:t,pr:n,p:o}},y={require:function(t){return c(t)},exports:function(t){var i=v[t];return"undefined"!=typeof i?i:v[t]={}},module:function(t){return{id:t,uri:"",exports:v[t],config:x(t)}}},u=function(i,o,s,p){var e,f,x,u,a,w,g=[],k=typeof s;if(p=p||i,"undefined"===k||"function"===k){for(o=!o.length&&s.length?["require","exports","module"]:o,a=0;a<o.length;a+=1)if(u=l(o[a],p),f=u.f,"require"===f)g[a]=y.require(i);else if("exports"===f)g[a]=y.exports(i),w=!0;else if("module"===f)e=g[a]=y.module(i);else if(n(v,f)||n(d,f)||n(m,f))g[a]=r(f);else{if(!u.p)throw new Error(i+" missing "+f);u.p.load(u.n,c(p,!0),h(f),{}),g[a]=v[f]}x=s?s.apply(v[i],g):void 0,i&&(e&&e.exports!==t&&e.exports!==v[i]?v[i]=e.exports:x===t&&w||(v[i]=x))}else i&&(v[i]=s)},i=o=a=function(i,o,s,n,p){if("string"==typeof i)return y[i]?y[i](o):r(l(i,o).f);if(!i.splice){if(w=i,w.deps&&a(w.deps,w.callback),!o)return;o.splice?(i=o,o=s,s=null):i=t}return o=o||function(){},"function"==typeof s&&(s=n,n=p),n?u(t,i,o,s):setTimeout(function(){u(t,i,o,s)},4),a},a.config=function(t){return a(t)},i._defined=v,s=function(t,i,o){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");i.splice||(o=i,i=[]),n(v,t)||n(d,t)||(d[t]=[t,i,o])},s.amd={jQuery:!0}}(),s("almond",function(){}),s("modules/Point",[],function(){function t(t,i,o){this.x=t,this.y=i,this.r=2,this.ctx=o}return t.prototype.draw=function(){this.ctx.fillStyle="#f00",this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.r,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill()},t}),s("modules/BezierPoint",["modules/Point"],function(t){function i(i,o,s,n){this.cpDist=n,this.position=new t(i,o,s),this.cp1=new t(i-this.cpDist,o,s),this.cp2=new t(i+this.cpDist,o,s),this.ctx=s,this.r=2,this.collapsed=!1}return i.prototype.collapse=function(){this.collapsed?(this.collapsed=!1,this.cp1.x=this.position.x-this.cpDist,this.cp2.x=this.position.x+this.cpDist):(this.collapsed=!0,this.cp1.x=this.cp2.x=this.position.x,this.cp1.y=this.cp2.y=this.position.y)},i.prototype.move=function(){this.collapsed?this.v1x=this.v1y=this.v2x=this.v2y=0:(this.v1x=this.cp1.x-this.position.x,this.v1y=this.cp1.y-this.position.y,this.v2x=this.cp2.x-this.position.x,this.v2y=this.cp2.y-this.position.y)},i.prototype.draw=function(){this.ctx.lineWidth=.2,this.ctx.beginPath(),this.ctx.moveTo(this.position.x,this.position.y),this.ctx.lineTo(this.cp1.x,this.cp1.y),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.position.x,this.position.y),this.ctx.lineTo(this.cp2.x,this.cp2.y),this.ctx.stroke(),this.position.draw(),this.cp1.draw(),this.cp2.draw()},i}),s("modules/Line",["modules/BezierPoint","jquery"],function(t,i){function o(i,o,s){this.cpDist=s,this.points=[new t(0,i.canvas.height,i,s),new t(i.canvas.width,0,i,s)],this.ctx=i,this.cw=i.canvas.width,this.ch=i.canvas.height,this.interval=o,this.canvasEvents(),this.createLUT(),this.draw()}o.prototype.xGetY=function(t){for(var i=1e-4,o=0,s=5e3,n=(o+s)/2,p=t/this.interval,c=this.lookupX[n],e=0;Math.abs(p-c)>i&&(e++,c>p?s=n:p>c&&(o=n),n=Math.round((o+s)/2),c=this.lookupX[n],!(e>20)););return this.lookupY[n]},o.prototype.createLUT=function(){this.lookupX=[],this.lookupY=[];for(var t=1;t<this.points.length;t++)for(var i=this.points[t-1],o=this.points[t],s=o.position.x/this.cw-i.position.x/this.cw,n=0;1>n;n+=1/(5e3*s)){var p=Math.pow(1-n,3)*i.position.x+3*Math.pow(1-n,2)*n*i.cp2.x+3*(1-n)*Math.pow(n,2)*o.cp1.x+Math.pow(n,3)*o.position.x,c=Math.pow(1-n,3)*i.position.y+3*Math.pow(1-n,2)*n*i.cp2.y+3*(1-n)*Math.pow(n,2)*o.cp1.y+Math.pow(n,3)*o.position.y;this.lookupX.push(p/this.cw),this.lookupY.push(-c/this.ch+1)}},o.prototype.canvasEvents=function(){var t,o,n,p,c,e,h=this;i(this.ctx.canvas).on("mousemove",function(r){t=r.clientX-i(this).offset().left,o=r.clientY-i(this).offset().top;for(var f=0;f<h.points.length;f++){var x=h.points[f];if(!e){if(n=Math.sqrt((t-x.position.x)*(t-x.position.x)+(o-x.position.y)*(o-x.position.y)),5>=n){i(this).css("cursor","pointer"),p=f;break}if(n=Math.sqrt((t-x.cp1.x)*(t-x.cp1.x)+(o-x.cp1.y)*(o-x.cp1.y)),5>=n){i(this).css("cursor","pointer"),p=f,c="cp1";break}if(n=Math.sqrt((t-x.cp2.x)*(t-x.cp2.x)+(o-x.cp2.y)*(o-x.cp2.y)),5>=n){i(this).css("cursor","pointer"),p=f,c="cp2";break}i(this).css("cursor","initial"),p=!1,c=!1}}if(s[18]){var u=h.cw/20,a=h.ch/10,l=Math.floor((t+u/2)/u),y=Math.floor((o+a/2)/a);t=u*l,o=a*y}if(i("span").text("X: "+t+", Y: "+o),e){if("cp1"==c)h.points[p].cp1.x=t,h.points[p].cp1.y=o,h.points[p].move(),s[16]||(h.points[p].cp2.x=t-2*h.points[p].v1x,h.points[p].cp2.y=o-2*h.points[p].v1y);else if("cp2"==c)h.points[p].cp2.x=t,h.points[p].cp2.y=o,h.points[p].move(),s[16]||(h.points[p].cp1.x=t-2*h.points[p].v2x,h.points[p].cp1.y=o-2*h.points[p].v2y);else{h.points[p].move(),h.points[p].position.x=t,h.points[p].position.y=o,0===p&&(h.points[p].position.x=0),p==h.points.length-1&&(h.points[p].position.x=h.cw),h.points[p].cp1.x=h.points[p].position.x+h.points[p].v1x,h.points[p].cp1.y=h.points[p].position.y+h.points[p].v1y,h.points[p].cp2.x=h.points[p].position.x+h.points[p].v2x,h.points[p].cp2.y=h.points[p].position.y+h.points[p].v2y;var v;h.points[p-1]&&h.points[p+1]&&(h.points[p].position.x>h.points[p+1].position.x&&(v=h.points[p],h.points[p]=h.points[p+1],h.points[p+1]=v,p++),h.points[p-1].position.x>h.points[p].position.x&&(v=h.points[p],h.points[p]=h.points[p-1],h.points[p-1]=v,p--))}h.draw()}}).on("mousedown",function(s){s.preventDefault(),p||0===p?e=!0:n>5&&(p=h.addPoint(t,o),e=!0,i(this).css("cursor","pointer"),h.draw())}).on("mouseup",function(s){e=!1,n>5&&(p=c=!1);for(var r=0;r<h.points.length;r++){var f=h.points[r];if(n=Math.sqrt((t-f.position.x)*(t-f.position.x)+(o-f.position.y)*(o-f.position.y)),5>=n){i(this).css("cursor","pointer"),p=r;break}}h.createLUT()}).on("mouseleave",function(i){e&&(i.offsetX<0||i.offsetX>h.cw?i.offsetX<0?"cp1"==c?(h.points[p].cp1.x=0,h.points[p].move(),s[16]||(h.points[p].cp2.x=0-2*h.points[p].v1x,h.points[p].cp2.y=o-2*h.points[p].v1y)):"cp2"==c?(h.points[p].cp2.x=0,h.points[p].move(),s[16]||(h.points[p].cp1.x=0-2*h.points[p].v2x,h.points[p].cp1.y=o-2*h.points[p].v2y)):(h.points[p].position.x=0,h.points[p].cp1.x=0+h.points[p].v1x,h.points[p].cp2.x=0+h.points[p].v2x):"cp1"==c?(h.points[p].cp1.x=h.cw,h.points[p].move(),s[16]||(h.points[p].cp2.x=h.cw-2*h.points[p].v1x,h.points[p].cp2.y=o-2*h.points[p].v1y)):"cp2"==c?(h.points[p].cp2.x=h.cw,h.points[p].move(),s[16]||(h.points[p].cp1.x=h.cw-2*h.points[p].v2x,h.points[p].cp1.y=o-2*h.points[p].v2y)):(h.points[p].position.x=h.cw,h.points[p].cp1.x=h.cw+h.points[p].v1x,h.points[p].cp2.x=h.cw+h.points[p].v2x):(i.offsetY<0||i.offsetY>h.ch)&&(i.offsetY<0?"cp1"==c?(h.points[p].cp1.y=0,h.points[p].move(),s[16]||(h.points[p].cp2.x=t-2*h.points[p].v1x,h.points[p].cp2.y=0-2*h.points[p].v1y)):"cp2"==c?(h.points[p].cp2.y=0,h.points[p].move(),s[16]||(h.points[p].cp1.x=t-2*h.points[p].v2x,h.points[p].cp1.y=0-2*h.points[p].v2y)):(h.points[p].position.y=0,h.points[p].cp1.y=0+h.points[p].v1y,h.points[p].cp2.y=0+h.points[p].v2y):"cp1"==c?(h.points[p].cp1.y=h.ch,h.points[p].move(),s[16]||(h.points[p].cp2.x=t-2*h.points[p].v1x,h.points[p].cp2.y=h.ch-2*h.points[p].v1y)):"cp2"==c?(h.points[p].cp2.y=h.ch,h.points[p].move(),s[16]||(h.points[p].cp1.x=t-2*h.points[p].v2x,h.points[p].cp1.y=h.ch-2*h.points[p].v2y)):(h.points[p].position.y=h.ch,h.points[p].cp1.y=h.ch+h.points[p].v1y,h.points[p].cp2.y=h.ch+h.points[p].v2y))),h.draw(),h.createLUT(),e=p=c=!1}).on("click",function(t){s[16]&&!c&&(h.points[p].collapse(),h.draw(),h.createLUT())}).on("dblclick",function(t){h.points.splice(p,1),e=p=c=!1,n=1e3,i(this).css("cursor","initial"),h.draw(),h.createLUT()})},o.prototype.addPoint=function(i,o){this.points.push(new t(i,o,this.ctx,this.cpDist)),this.points.sort(function(t,i){return t.position.x-i.position.x});for(var s=0;s<this.points.length;s++){var n=this.points[s];if(i==n.position.x&&o==n.position.y)return s}},o.prototype.draw=function(){for(this.ctx.clearRect(0,0,this.cw,this.ch),this.ctx.strokeStyle="#444",this.ctx.lineWidth=1,o=1;10>o;o++)this.ctx.beginPath(),this.ctx.moveTo(this.cw/10*o-.5,0),this.ctx.lineTo(this.cw/10*o-.5,this.ch),this.ctx.stroke();for(o=1;5>o;o++)this.ctx.beginPath(),this.ctx.moveTo(0,this.ch/5*o-.5),this.ctx.lineTo(this.cw,this.ch/5*o-.5),this.ctx.stroke();for(this.ctx.lineWidth=.5,o=1;20>o;o++)this.ctx.beginPath(),this.ctx.moveTo(this.cw/20*o-.5,0),this.ctx.lineTo(this.cw/20*o-.5,this.ch),this.ctx.stroke();for(o=1;10>o;o++)this.ctx.beginPath(),this.ctx.moveTo(0,this.ch/10*o-.5),this.ctx.lineTo(this.cw,this.ch/10*o-.5),this.ctx.stroke();for(this.ctx.strokeStyle="#fff",this.ctx.beginPath(),this.ctx.moveTo(this.points[0].position.x,this.points[0].position.y),o=1;o<this.points.length;o++){var t=this.points[o],i=this.points[o-1];this.ctx.bezierCurveTo(i.cp2.x,i.cp2.y,t.cp1.x,t.cp1.y,t.position.x,t.position.y)}this.ctx.stroke();for(var o=0;o<this.points.length;o++)this.points[o].draw()};var s=[];return window.addEventListener("keydown",function(t){s[t.keyCode]=!0}),window.addEventListener("keyup",function(t){delete s[t.keyCode]}),o}),s("main",["modules/Line"],function(t){return t}),s("jquery",function(){return t}),o("main")});
//# sourceMappingURL=almond.build.js.map
//# sourceMappingURL=curveEditor.min.js.map
